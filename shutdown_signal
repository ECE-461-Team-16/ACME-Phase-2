const fs = require('fs');
const path = '/home/ubuntu/ACME-Phase-2/shutdown_signal';
const runningLockPath = '/home/ubuntu/ACME-Phase-2/running.lock';

// Ensure running.lock exists while the application is running
fs.writeFileSync(runningLockPath, 'running');

// Watch for the shutdown_signal file to trigger graceful shutdown
const checkShutdownSignal = () => {
    if (fs.existsSync(path)) {
        console.log('Shutdown signal received. Stopping the application...');
        // Perform your shutdown operations here
        // For example, closing DB connections, saving state, etc.

        // Once shutdown is complete, delete the running lock
        fs.unlinkSync(runningLockPath);
        console.log('Application stopped.');
        process.exit(0); // Exit the application
    }
};

// Check for shutdown signal every 5 seconds
setInterval(checkShutdownSignal, 5000);
